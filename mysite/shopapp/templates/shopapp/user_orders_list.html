{% extends "base.html" %}
{% load static %}

{% block title %}
    {{ shop_name|default:"TechStore" }} - –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ owner.username }}
{% endblock %}

{% block subtitle %}
    –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ owner.username }}
{% endblock %}


{% load static %}
{% load cache %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'shopapp/css/user_orders_list.css' %}">

{% endblock %}

{% block main %}
    <!-- –®–∞–ø–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="page-header">
        <h1>–ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
    </div>

    <!-- –ë–ª–æ–∫ 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div class="user-section">
        <div class="user-header">
            <div class="user-avatar">
                {{ owner.username|first|upper }}
            </div>
            <div class="user-info">
                <div class="user-name">
                    {{ owner.username }}
                    {% if request.user == owner %}
                        <span class="status-badge badge-owner">–í—ã</span>
                    {% elif request.user.is_staff %}
                        <span class="status-badge badge-staff">–ê–¥–º–∏–Ω</span>
                    {% endif %}
                </div>
                <div class="user-email">{{ owner.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</div>
            </div>
        </div>

        <div class="user-meta">
            <div class="meta-item">
                <span class="meta-label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
                <span class="meta-value">#{{ owner.id }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</span>
                <span class="meta-value">{{ orders_count }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">–°—Ç–∞—Ç—É—Å</span>
                <span class="meta-value">
                    {% if owner.is_active %}–ê–∫—Ç–∏–≤–µ–Ω{% else %}–ù–µ–∞–∫—Ç–∏–≤–µ–Ω{% endif %}
                </span>
            </div>
            <div class="meta-item">
                <span class="meta-label">–¢–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                <span class="meta-value">
                    {% if owner.is_staff %}Staff{% else %}User{% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ 2: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <h2 class="orders-title">–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h2>

    {% cache 300 "user_order_cache"  owner.id%}
        <!-- –ë–ª–æ–∫ 3: –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
        {% if user_orders %}
            {% for order in user_orders %}
                <div class="order-block">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–∫–∞–∑–∞ -->
                    <div class="order-header">
                        <div class="order-number">–ó–∞–∫–∞–∑ #{{ order.id }}</div>
                        <div class="order-date">{{ order.created_at|date:"d.m.Y H:i" }}</div>
                    </div>

                    <!-- –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ -->
                    <div class="order-details">
                        <div class="detail-field">
                            <span class="detail-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</span>
                            <div class="detail-value {% if not order.delivery_adress %}empty{% endif %}">
                                {{ order.delivery_adress|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}
                            </div>
                        </div>

                        <div class="detail-field">
                            <span class="detail-label">–ü—Ä–æ–º–æ–∫–æ–¥</span>
                            <div class="detail-value {% if not order.promocode %}empty{% endif %}">
                                {{ order.promocode|default:"–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω" }}
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –≤ –∑–∞–∫–∞–∑–µ -->
                    <div class="products-header">
                        –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ ({{ order.products.count }})
                    </div>

                    <div class="products-list">
                        {% for product in order.products.all %}
                            <div class="product-item">
                                <div class="product-name">{{ product.name }}</div>
                                <div class="product-price">${{ product.price }}</div>
                                {% if product.description %}
                                    <div class="product-meta">{{ product.description|truncatechars:60 }}</div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-orders">
                <div class="empty-icon">üì≠</div>
                <h3>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</h3>
                <p>–£ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ –∑–∞–∫–∞–∑–æ–≤</p>
            </div>
        {% endif %}
    {% endcache %}
{% endblock %}