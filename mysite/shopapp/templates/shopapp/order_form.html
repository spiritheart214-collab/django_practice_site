{% extends "base.html" %}
{% load static %}

{% block title %}
    Create Order - {% block subtitle %}New Order{% endblock %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'shopapp/css/create-order.css' %}">
{% endblock %}

{% block main %}
<div class="order-form-container">
    <div class="form-header">
        <h1 class="form-title">üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
        <p class="form-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ</p>
    </div>

    <form method="post" class="order-form" id="orderForm">
        {% csrf_token %}
        
        <!-- –ü–æ–ª–µ: –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ -->
        <div class="form-group">
            <label for="{{ form.delivery_adress.id_for_label }}" class="form-label">
                <span class="label-icon">üìç</span>
                {{ form.delivery_adress.label }}
            </label>
            {{ form.delivery_adress }}
            {% if form.delivery_adress.errors %}
                <div class="error-message">
                    {% for error in form.delivery_adress.errors %}
                        <span class="error-icon">‚ö†Ô∏è</span> {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="input-hint">–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
        </div>

        <!-- –ü–æ–ª–µ: –ü—Ä–æ–º–æ–∫–æ–¥ -->
        <div class="form-group">
            <label for="{{ form.promocode.id_for_label }}" class="form-label">
                <span class="label-icon">üé´</span>
                {{ form.promocode.label }}
            </label>
            {{ form.promocode }}
            {% if form.promocode.errors %}
                <div class="error-message">
                    {% for error in form.promocode.errors %}
                        <span class="error-icon">‚ö†Ô∏è</span> {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="input-hint">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
        </div>

        <!-- –ü–æ–ª–µ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
        <div class="form-group">
            <label for="{{ form.user.id_for_label }}" class="form-label">
                <span class="label-icon">üë§</span>
                {{ form.user.label }}
            </label>
            {{ form.user }}
            {% if form.user.errors %}
                <div class="error-message">
                    {% for error in form.user.errors %}
                        <span class="error-icon">‚ö†Ô∏è</span> {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="input-hint">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–∫–∞–∑–∞</div>
        </div>

        <!-- –ü–æ–ª–µ: –¢–æ–≤–∞—Ä—ã -->
        <div class="form-group">
            <label for="{{ form.products.id_for_label }}" class="form-label">
                <span class="label-icon">üõçÔ∏è</span>
                {{ form.products.label }}
            </label>
            {{ form.products }}
            {% if form.products.errors %}
                <div class="error-message">
                    {% for error in form.products.errors %}
                        <span class="error-icon">‚ö†Ô∏è</span> {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="input-hint">
                –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd –Ω–∞ Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤. 
                –ú–∞–∫—Å–∏–º—É–º 10 —Ç–æ–≤–∞—Ä–æ–≤.
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
        <button type="submit" class="submit-button">
            <span class="button-icon">üöÄ</span>
            –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
        </button>
    </form>

    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞–∑–∞–¥ -->
    <div class="back-link">
        <a href="{% url 'shopapp:orders_list' %}" class="back-button">
            <span class="back-icon">‚Üê</span>
            –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('orderForm');
    const productsSelect = document.getElementById('{{ form.products.id_for_label }}');
    
    // –ü–æ–¥—Å—á–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    if (productsSelect) {
        productsSelect.addEventListener('change', function() {
            const selectedCount = Array.from(this.selectedOptions).length;
            const counter = document.getElementById('products-counter') || 
                           createProductsCounter();
            
            counter.textContent = `–í—ã–±—Ä–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${selectedCount}/10`;
            
            if (selectedCount > 10) {
                counter.classList.add('error');
            } else {
                counter.classList.remove('error');
            }
        });
        
        function createProductsCounter() {
            const counter = document.createElement('div');
            counter.id = 'products-counter';
            counter.className = 'products-counter';
            productsSelect.parentNode.appendChild(counter);
            return counter;
        }
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function() {
        const button = this.querySelector('.submit-button');
        const originalText = button.innerHTML;
        
        button.innerHTML = `
            <span class="button-icon">‚è≥</span>
            –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞...
        `;
        button.disabled = true;
        
        setTimeout(() => {
            button.disabled = false;
            button.innerHTML = originalText;
        }, 5000);
    });
});
</script>
{% endblock %}